{"ast":null,"code":"/**\n * A client that makes requests to Elasticsearch via a {{#crossLink \"Transport\"}}Transport{{/crossLink}}\n *\n * Initializing a client might look something like:\n *\n * ```\n * var client = new es.Client({\n *   hosts: [\n *     'es1.net:9200',\n *     {\n *       host: 'es2.net',\n *       port: 9200\n *     }\n *   ],\n *   sniffOnStart: true,\n *   log: {\n *     type: 'file',\n *     level: 'warning'\n *   }\n * });\n * ```\n *\n * @class Client\n * @constructor\n */\nmodule.exports = Client;\n\nvar Transport = require('./transport');\n\nvar clientAction = require('./client_action');\n\nvar _ = require('lodash');\n\nvar utils = require('./utils');\n\nfunction Client(config) {\n  config = config || {};\n\n  if (config.__reused) {\n    throw new Error('Do not reuse objects to configure the elasticsearch Client class: ' + 'https://github.com/elasticsearch/elasticsearch-js/issues/33');\n  } else {\n    config.__reused = true;\n  }\n\n  function EsApiClient() {\n    // our client will log minimally by default\n    if (!config.hasOwnProperty('log')) {\n      config.log = 'warning';\n    }\n\n    if (!config.hosts && !config.host) {\n      config.host = 'http://localhost:9200';\n    }\n\n    this.close = function () {\n      this.transport.close();\n    };\n\n    this.transport = new Transport(config);\n\n    _.each(EsApiClient.prototype, _.bind(function (Fn, prop) {\n      if (Fn.prototype instanceof clientAction.ApiNamespace) {\n        this[prop] = new Fn(this.transport, this);\n      }\n    }, this));\n\n    delete this._namespaces;\n  }\n\n  EsApiClient.prototype = utils.funcEnum(config, 'apiVersion', Client.apis, '_default');\n\n  if (!config.sniffEndpoint && EsApiClient.prototype === Client.apis['0.90']) {\n    config.sniffEndpoint = '/_cluster/nodes';\n  }\n\n  var Constructor = EsApiClient;\n\n  if (config.plugins) {\n    Constructor.prototype = _.cloneDeep(Constructor.prototype);\n\n    _.each(config.plugins, function (setup) {\n      Constructor = setup(Constructor, config, {\n        apis: require('./apis'),\n        connectors: require('./connectors'),\n        loggers: require('./loggers'),\n        selectors: require('./selectors'),\n        serializers: require('./serializers'),\n        Client: require('./client'),\n        clientAction: clientAction,\n        Connection: require('./connection'),\n        ConnectionPool: require('./connection_pool'),\n        Errors: require('./errors'),\n        Host: require('./host'),\n        Log: require('./log'),\n        Logger: require('./logger'),\n        NodesToHost: require('./nodes_to_host'),\n        Transport: require('./transport')\n      }) || Constructor;\n    });\n  }\n\n  return new Constructor();\n}\n\nClient.apis = require('./apis');","map":null,"metadata":{},"sourceType":"script"}